<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title></title>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    </head>
    <body>
        {% block body %}
        <h1>
            {% if name %}
                Hello, {{ name }}
            {% else %}
                you vegatable
            {% endif %}
        </h1>
        {% endblock %}
        <input accept="image/*" name="upimage" id="upload_file" type="file">
        <button id="btn">点击</button>
        <textarea id="base64_output" name="Word" style=" width:1000px"></textarea>
        <script type="text/javascript">
            var get_base64num = '';
            document.getElementById("upload_file").onchange = function () {
                gen_base64();
            };
            function $_(id) {
                    return document.getElementById(id);
            }
            function gen_base64() {
                var file = $_('upload_file').files[0];

                r = new FileReader();  //本地预览
                r.onload = function(){
                    $_('base64_output').value = r.result;
                    get_base64num = r.result;
                };
                r.readAsDataURL(file);    //Base64
                var reader = new FileReader();
                reader.onload=function(event){
                    var dataurl=event.target.result,
                    img =document.createElement("img");
                    img.src=dataurl;
                    document.body.appendChild(img);
                };
                reader.onerror = function(event) {
                console.error("File could not be read! Code " + event.target.error.code);
};

reader.readAsDataURL(file);


            }

            $(function(){
                $("#btn").click(function(){
                    {#console.log(get_base64num);#}
                    $.ajax({
                    url:'http://127.0.0.1:5000/',
                    type:'POST',
                    data:get_base64num,
                    dataType: 'text',
                    success:function(res){
                        console.log(res);
                        console.log(0)

                    },
                    error:function (res) {
                        console.log(res);
                        console.log(1)
                    }

                })
        })
    })
        </script>
    </body>
</html>